<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Bootstrap CSS -->
    <link rel="shortcut icon" type="image/x-icon" href="/web/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <title>Edit Clients</title>
    <style>
        .modal.blur {
            filter: blur(5px);
            pointer-events: none;
        }
       
    </style>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-dark navbar-dark py-3 fixed-top">
            <div class="container">
                <a class="navbar-brand" href="index.html">Senioro</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <p></p>
                <div class="navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse">
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link text-light" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" href="addClient.html">Add New Client</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" href="editClient.html">Edit Client</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" href="filterClients.html">Filter Client</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <main role="main" class="pb-3">
        </main>
    </div>
    <br><br>

    <div class="container mt-4">
        <form id="updateForm">
            <div class="col-md-12 text-center">
                <h1>Update Client Info</h1>
                <br>
                <div class="form-group">
                    <label for="idClient" class="text-center"><b>Client ID: </b></label>
                    <br>
                    <input type="text" class="form-control" id="idClient">
                </div>
              
                <button type="button" id="searchButton" class="btn btn-primary">Search</button>
            </div>
        </form>

        <!-- Modal for updating record -->
        <div class="modal fade" id="updateModal" name="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModal"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateLabel">Update Record</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body text-left">
                        <form>
                            <div class="form-group">
                                <label for="firstName">First Name:</label>
                                <input type="text" class="form-control" id="firstName">
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name:</label>
                                <input type="text" class="form-control" id="lastName">
                            </div>
                            <div class="form-group">
                                <label for="dateOfBirth">Date of Birth:</label>
                                <input type="text" class="form-control" id="dateOfBirth">
                            </div>
                            <div class="form-group">
                                <label for="phoneNumber">Phone Number:</label>
                                <input type="text" class="form-control" id="phoneNumber">
                            </div>
                            <div class="form-group">
                                <label for="gender">Gender:</label>
                                <select class="form-control" id="gender">
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="monthlyPayment">Monthly Payment:</label>
                                <input type="text" class="form-control" id="monthPayment">
                            </div>
                            <div class="form-group">
                                <label for="pension">Pension:</label>
                                <input type="text" class="form-control" id="pension">
                            </div>
                            <div class="form-group">
                                <label for="roomNo">Room Number:</label>
                                <input type="text" class="form-control" id="roomNo">
                            </div>
                            <div class="form-group">
                                <label for="diagnose1">Diagnose 1:</label>
                                <input type="text" class="form-control" id="diagnose1">
                            </div>
                            <div class="form-group">
                                <label for="diagnose2">Diagnose 2:</label>
                                <input type="text" class="form-control" id="diagnose2">
                            </div>
                            <div class="form-group">
                                <label for="diagnose3">Diagnose 3:</label>
                                <input type="text" class="form-control" id="diagnose3">
                            </div>
                            <div class="form-group">
                                <label for="immobility">Immobility:</label>
                                <select class="form-control" id="immobility">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dependency">Dependency:</label>
                                <select class="form-control" id="dependency">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateOfArrival">Date of Arrival:</label>
                                <input type="text" class="form-control" id="dateOfArrival">
                            </div>
                            <div class="form-group">
                                <label for="dateOfDeparture">Date of Departure:</label>
                                <input type="text" class="form-control" id="dateOfDeparture">
                            </div>
                            <div class="form-group">
                                <label>Contact Person:</label>
                                <div class="row">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="contactName" placeholder="Name">
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="contactLastName" placeholder="Last Name">
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="contactPhoneNumber" placeholder="Phone Number">
                                    </div>
                                </div>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary float-left" id="saveChanges">Save changes</button>
                                <button type="button" class="btn btn-danger" data-toggle="modal" id="deleteButton" name="deleteButton" data-target="#confirmationModal">Delete Entry</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div id="errorMessage" class="alert alert-danger text-center" role="alert" style="display: none;">
            ID not found.
        </div>
    </div>

    <div class="modal" tabindex="-1" role="dialog" id="confirmationModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this entry?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete Entry</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editSuccessModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Entry updated</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteSuccessModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Entry deleted</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            $('#searchButton').click(function () {
                var id = $('#idClient').val();
                $.ajax({
                    type: 'POST',
                    url: 'https://localhost:44395/WebService1.asmx/SearchEntry',
                    data: JSON.stringify({ id: id }),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (response) {
                        if (response.d != 'Entry not found') {
                            var xmlDoc = $.parseXML(response.d);
                            var $xml = $(xmlDoc);
                            var firstName = $xml.find('firstName').text();
                            var lastName = $xml.find('lastName:not(contactPerson > lastName)').text();
                            var dateOfBirth = $xml.find('dateOfBirth').text();
                            var phoneNumber = $xml.find('phoneNumber:not(contactPerson > phoneNumber)').text();
                            var gender = $xml.find('gender').text();
                            var monthPayment = $xml.find('monthPayment').text();
                            var pension = $xml.find('pension').text();
                            var roomNo = $xml.find('roomNo').text();
                            var diagnose1 = $xml.find('diagnose1').text();
                            var diagnose2 = $xml.find('diagnose2').text();
                            var diagnose3 = $xml.find('diagnose3').text();
                            var immobility = $xml.find('immobility').text();
                            var dependency = $xml.find('dependency').text();
                            var dateOfArrival = $xml.find('dateOfArrival').text();
                            var dateOfDeparture = $xml.find('dateOfDeparture').text();
                            var contactName = $xml.find('contactPerson name').text();
                            var contactLastName = $xml.find('contactPerson lastName').text();
                            var contactPhoneNumber = $xml.find('contactPerson phoneNumber').text();

                            $('#firstName').val(firstName);
                            $('#lastName').val(lastName);
                            $('#dateOfBirth').val(dateOfBirth);
                            $('#phoneNumber').val(phoneNumber);
                            $('#gender').val(gender);
                            $('#monthPayment').val(monthPayment);
                            $('#pension').val(pension);
                            $('#roomNo').val(roomNo);
                            $('#diagnose1').val(diagnose1);
                            $('#diagnose2').val(diagnose2);
                            $('#diagnose3').val(diagnose3);
                            $('#immobility').val(immobility);
                            $('#dependency').val(dependency);
                            $('#dateOfArrival').val(dateOfArrival);
                            $('#dateOfDeparture').val(dateOfDeparture);
                            $('#contactName').val(contactName);
                            $('#contactLastName').val(contactLastName);
                            $('#contactPhoneNumber').val(contactPhoneNumber);
                            $('#updateModal').modal('show');
                        } else {
                            $('#errorMessage').show();
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    }
                });
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#saveChanges').click(function () {
                var id = $('#idClient').val();
                var firstName = $('#firstName').val();
                var lastName = $('#lastName').val();
                var dateOfBirth = $('#dateOfBirth').val();
                var phoneNumber = $('#phoneNumber').val();
                var gender = $('#gender').val();
                var monthPayment = $('#monthPayment').val();
                var pension = $('#pension').val();
                var roomNo = $('#roomNo').val();
                var diagnose1 = $('#diagnose1').val();
                var diagnose2 = $('#diagnose2').val();
                var diagnose3 = $('#diagnose3').val();
                var immobility = $('#immobility').val();
                var dependency = $('#dependency').val();
                var dateOfArrival = $('#dateOfArrival').val();
                var dateOfDeparture = $('#dateOfDeparture').val();
                var contactName = $('#contactName').val();
                var contactLastName = $('#contactLastName').val();
                var contactPhoneNumber = $('#contactPhoneNumber').val();

                $.ajax({
                    type: "POST",
                    url: "https://localhost:44395/WebService1.asmx/UpdateEntry",
                    data: JSON.stringify({
                        id: id, firstName: firstName, lastName: lastName, dateOfBirth: dateOfBirth,
                        phoneNumber: phoneNumber, gender: gender, monthPayment: monthPayment, pension: pension,
                        roomNo: roomNo, diagnose1: diagnose1, diagnose2: diagnose2, diagnose3: diagnose3,
                        immobility: immobility, dependency: dependency, dateOfArrival: dateOfArrival,
                        dateOfDeparture: dateOfDeparture, contactName: contactName, contactLastName: contactLastName,
                        contactPhoneNumber: contactPhoneNumber
                    }),
                    contentType: "application/json; charset=utf-8",
                    success: function (response) {
                        if (response.d === 'Entry updated') {
                            $('#editSuccessModal').modal('show');
                        } else {
                            alert("Error updating record with id " + id + ".");
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    }
                });
            });
            $('#editSuccessModal').on('show.bs.modal', function () {
                $('#updateModal').addClass('blur');
            }).on('hidden.bs.modal', function () {
                $('#updateModal').modal('hide');
                $('#updateModal').removeClass('blur');
            });
        });
    </script>

    <script>
        $(function () {
            $('#confirmDelete').click(function () {
                var id = $('#idClient').val();
                $('#confirmationModal').modal('hide');
                $.ajax({
                    type: 'POST',
                    url: 'https://localhost:44395/WebService1.asmx/DeleteEntry',
                    data: JSON.stringify({ id: id }),
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        if (response.d === 'Entry deleted') {
                            $('#deleteSuccessModal').modal('show');
                        } else {
                            alert("Error deleting record with id " + id + ".");
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    }
                });
            });
            $('#confirmationModal').on('show.bs.modal', function () {
                $('#updateModal').addClass('blur');
            }).on('hidden.bs.modal', function () {
                $('#updateModal').removeClass('blur');
            });
            $('#deleteSuccessModal').on('show.bs.modal', function () {
                $('#updateModal').addClass('blur');
            }).on('hidden.bs.modal', function () {
                $('#updateModal').modal('hide');
                $('#updateModal').removeClass('blur');
            });

        });
    </script>

    <script>
        $(document).ready(function () {
            $('#dateOfArrival').datepicker({
                format: 'dd.mm.yyyy',
                autoclose: true,
                todayHighlight: true
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#dateOfDeparture').datepicker({
                format: 'dd.mm.yyyy',
                autoclose: true,
                todayHighlight: true
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#dateOfBirth').datepicker({
                format: 'dd.mm.yyyy',
                autoclose: true,
                todayHighlight: true
            });
        });
    </script>

</body>
</html>
<footer class="p-5 bg-dark text-white text-center mt-auto fixed-bottom">
    <div class="container">
        <p class="lead">Copyright &copy; 2023 Martin Lukáč</p>
    </div>
</footer>